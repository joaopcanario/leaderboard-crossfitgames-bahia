<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Crossfit Games Leaderboard para os atletas da bahia">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>Crossfit Games Bahia</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-red.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
    #view-source {
      position: fixed;
      display: block;
      right: 0;
      bottom: 0;
      margin-right: 40px;
      margin-bottom: 40px;
      z-index: 900;
    }
    </style>
  </head>
  <body>
    <div class="demo-layout mdl-layout mdl-layout--fixed-header mdl-js-layout mdl-color--grey-100">
      <div class="demo-ribbon"></div>
      <main class="demo-main mdl-layout__content">
        <div class="demo-container mdl-grid">
          <div class="center panel demo-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col">
            <h3 class="center title">Leaderboard - Crossfit Games - Bahia</h3>

            <div class="leaderboard-type">
              <button id="menLeaderboard" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
                MASCULINO RX
              </button>

              <button id="womenLeaderboard" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
                FEMININO RX
              </button>
            </div>

            <div class="demo-crumbs mdl-color-text--grey-500 leaderboard-description">
              Exibindo leaderboard para <strong><span id="type">MASCULINO RX</span></strong>
            </div>

            <table class="centered-table mdl-data-table mdl-js-data-table mdl-shadow--2dp">
              <thead>
                <tr>
                  <th class="mdl-data-table__cell--non-numeric">#</th>
                  <th class="mdl-data-table__cell--non-numeric">Nome</th>
                  <th class="mdl-data-table__cell--non-numeric">Box</th>
                  <th>Score</th>
                  <th>17.1</th>
                  <th>17.2</th>
                  <th>17.3</th>
                  <th>17.4</th>
                  <th>17.5</th>
                </tr>
              </thead>
              <tbody id="leaderboard">
              </tbody>
            </table>

            <div class="demo-crumbs mdl-color-text--grey-500 authors">
              Criado por <a href="http://github.com/cristianossd" target="_blank">Cristiano Santos</a> e
              <a href="http://github.com/joaopcanario" target="_blank">João Paulo Canário</a> <br />
              Informações processadas do <a href="http://games.crossfit.com">Crossfit Games</a>
            </div>
          </div>
        </div>
      </main>
    </div>
    <a href="mailto:cristianossd@gmail.com" target="_blank" id="view-source" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-color--accent mdl-color-text--accent-contrast">ALGO DE ERRADO?</a>
    <script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script>
      function loadJSON(file, callback) {
        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open('GET', file, true);
        xobj.onreadystatechange = function () {
          if (xobj.readyState == 4 && xobj.status == "200") {
            callback(xobj.responseText);
          }
        };
        xobj.send(null);
      }

      function generateLeaderboard(file) {
        loadJSON(file, function(json) {
          var athletes = JSON.parse(json);
          var pos = 1, next = 1, prev = 0;

          var leaderboard = document.getElementById('leaderboard');
          leaderboard.innerHTML = "";

          athletes.forEach(athlete => {
            if (prev != athlete.overallScore) {
              pos = next;
            }

            prev = athlete.overallScore;
            next++;

            var elem = `
              <tr>
                <td>${pos}</td>
                <td class="mdl-data-table__cell--non-numeric">${athlete.name}</td>
                <td>${athlete.affiliate}</td>
                <td>${athlete.overallScore}</td>
                <td>${athlete.wod1Display} (${athlete.wod1Rank})</td>
                <td>${athlete.wod2Display} (${athlete.wod2Rank})</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
              </tr>
            `;

            leaderboard.innerHTML += elem;
          });
        });
      }

      function updateLeaderboardDescription(text) {
        var type = document.getElementById('type');
        type.innerHTML = text;
      };

      generateLeaderboard("men_leaderboard.json");

      var men = document.getElementById('menLeaderboard');
      men.addEventListener('click', () => {
        updateLeaderboardDescription('MASCULINO RX');
        generateLeaderboard("men_leaderboard.json");
      });

      var women = document.getElementById('womenLeaderboard');
      women.addEventListener('click', () => {
        updateLeaderboardDescription('FEMININO RX');
        generateLeaderboard("women_leaderboard.json");
      });
    </script>
  </body>
</html>
